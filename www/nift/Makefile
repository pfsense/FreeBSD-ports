PORTNAME=	nift
DISTVERSIONPREFIX=	v
DISTVERSION=	2.4.11
PORTREVISION=	1
CATEGORIES=	www

MAINTAINER=	info@babaei.net
COMMENT=	Cross-platform open source website generator
WWW=		https://www.nift.cc

LICENSE=	MIT
LICENSE_FILE=	${WRKSRC}/LICENSE

USES=		compiler:c++11-lang gmake
USE_GITHUB=	yes
GH_ACCOUNT=	nifty-site-manager
GH_PROJECT=	nsm

PLIST_FILES=	bin/nift \
		bin/nsm

OPTIONS_DEFAULT=		PORTS_LUAJIT
OPTIONS_DEFAULT_riscv64=	BUNDLED_LUA53
OPTIONS_SINGLE=		LUA
OPTIONS_SINGLE_LUA=	BUNDLED_LUAJIT BUNDLED_LUA53 PORTS_LUAJIT PORTS_LUA54 PORTS_LUA53 PORTS_LUA52 PORTS_LUA51
OPTIONS_EXCLUDE_riscv64=	BUNDLED_LUAJIT
NO_OPTIONS_SORT=	yes

BUNDLED_LUA53_DESC=	Use the bundled Lua 5.3
BUNDLED_LUAJIT_DESC=	Use the bundled LuaJIT
PORTS_LUA51_DESC=	Use Lua 5.1 from FreeBSD Ports
PORTS_LUA52_DESC=	Use Lua 5.2 from FreeBSD Ports
PORTS_LUA53_DESC=	Use Lua 5.3 from FreeBSD Ports
PORTS_LUA54_DESC=	Use Lua 5.4 from FreeBSD Ports
PORTS_LUAJIT_DESC=	Use LuaJIT from FreeBSD Ports

BUNDLED_LUA53_MAKE_ARGS=	BUNDLED=1 LUA_VERSION=5.3
BUNDLED_LUA53_VARS=		MAKE_JOBS_UNSAFE=	yes
BUNDLED_LUAJIT_MAKE_ARGS=	BUNDLED=1
BUNDLED_LUAJIT_VARS=		MAKE_JOBS_UNSAFE=	yes
PORTS_LUA51_LIB_DEPENDS=	liblua-5.1.so:lang/lua51
PORTS_LUA51_MAKE_ARGS=		BUNDLED=0 LUA_VERSION=5.1
PORTS_LUA52_LIB_DEPENDS=	liblua-5.2.so:lang/lua52
PORTS_LUA52_MAKE_ARGS=		BUNDLED=0 LUA_VERSION=5.2
PORTS_LUA53_LIB_DEPENDS=	liblua-5.3.so:lang/lua53
PORTS_LUA53_MAKE_ARGS=		BUNDLED=0 LUA_VERSION=5.3
PORTS_LUA54_LIB_DEPENDS=	liblua-5.4.so:lang/lua54
PORTS_LUA54_MAKE_ARGS=		BUNDLED=0 LUA_VERSION=5.4
PORTS_LUAJIT_USES=		luajit
PORTS_LUAJIT_MAKE_ARGS=		BUNDLED=0 LUAJIT_VERSION=${LUAJIT_LUAVER}

post-patch:
	${REINPLACE_CMD} -e 's|%%LOCALBASE%%|${LOCALBASE}|g' \
		${WRKSRC}/Makefile

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/nift
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/nsm

.include <bsd.port.mk>
