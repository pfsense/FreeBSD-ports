# Created by: Mohammad S. Babaei <info@babaei.net>
# $FreeBSD$

PORTNAME=	nift
DISTVERSIONPREFIX=	v
DISTVERSION=	2.3.10
CATEGORIES=	www

MAINTAINER=	info@babaei.net
COMMENT=	Cross-platform open source website generator

LICENSE=	MIT
LICENSE_FILE=	${WRKSRC}/LICENSE

USES=		compiler:c++11-lang gmake
USE_GITHUB=	yes
GH_ACCOUNT=	nifty-site-manager
GH_PROJECT=	nsm

NO_OPTIONS_SORT=	yes
OPTIONS_SINGLE=		LUA
OPTIONS_SINGLE_LUA=	BUNDLED_LUAJIT BUNDLED_LUA53 PORTS_LUAJIT PORTS_LUA53 PORTS_LUA52 PORTS_LUA51

OPTIONS_DEFAULT=	BUNDLED_LUAJIT
OPTIONS_DEFAULT_powerpc64=	BUNDLED_LUA53
OPTIONS_DEFAULT_powerpc64le=	BUNDLED_LUA53
OPTIONS_DEFAULT_riscv64=	BUNDLED_LUA53
OPTIONS_EXCLUDE_powerpc64=	BUNDLED_LUAJIT
OPTIONS_EXCLUDE_powerpc64le=	BUNDLED_LUAJIT
OPTIONS_EXCLUDE_riscv64=	BUNDLED_LUAJIT

BUNDLED_LUAJIT_DESC=	Use the bundled LuaJIT
BUNDLED_LUA53_DESC=	Use the bundled Lua 5.3
PORTS_LUAJIT_DESC=	Use LuaJIT from FreeBSD Ports
PORTS_LUA53_DESC=	Use Lua 5.3 from FreeBSD Ports
PORTS_LUA52_DESC=	Use Lua 5.2 from FreeBSD Ports
PORTS_LUA51_DESC=	Use Lua 5.1 from FreeBSD Ports

BUNDLED_LUAJIT_MAKE_ARGS=	BUNDLED=1
BUNDLED_LUAJIT_VARS=		MAKE_JOBS_UNSAFE=	yes
BUNDLED_LUA53_MAKE_ARGS=	BUNDLED=1 LUA_VERSION=5.3
BUNDLED_LUA53_VARS=		MAKE_JOBS_UNSAFE=	yes
PORTS_LUAJIT_MAKE_ARGS=		BUNDLED=0 LUAJIT_VERSION=2.0
PORTS_LUAJIT_LIB_DEPENDS=	libluajit-5.1.so:lang/luajit
PORTS_LUA53_MAKE_ARGS=		BUNDLED=0 LUA_VERSION=5.3
PORTS_LUA53_LIB_DEPENDS=	liblua-5.3.so:lang/lua53
PORTS_LUA52_MAKE_ARGS=		BUNDLED=0 LUA_VERSION=5.2
PORTS_LUA52_LIB_DEPENDS=	liblua-5.2.so:lang/lua52
PORTS_LUA51_MAKE_ARGS=		BUNDLED=0 LUA_VERSION=5.1
PORTS_LUA51_LIB_DEPENDS=	liblua-5.1.so:lang/lua51

PLIST_FILES=	bin/nift \
		bin/nsm
post-patch:
	${REINPLACE_CMD} -e 's|%%LOCALBASE%%|${LOCALBASE}|g' \
		${WRKSRC}/Makefile

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/nift
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/nsm

.include <bsd.port.mk>
