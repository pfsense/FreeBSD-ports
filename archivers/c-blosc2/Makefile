# Created by: Po-Chuan Hsieh <sunpoet@FreeBSD.org>

PORTNAME=	c-blosc2
PORTVERSION=	2.0.4
DISTVERSIONPREFIX=	v
CATEGORIES=	archivers

MAINTAINER=	sunpoet@FreeBSD.org
COMMENT=	High performance compressor optimized for binary data

LICENSE=	BSD3CLAUSE
LICENSE_FILE=	${WRKSRC}/LICENSE.txt

LIB_DEPENDS=	liblz4.so:archivers/liblz4 \
		libzstd.so:archivers/zstd

USES=		cmake

CMAKE_OFF=	BUILD_LITE DEACTIVATE_AVX2 DEACTIVATE_ZLIB DEACTIVATE_ZSTD
CMAKE_ON=	BUILD_BENCHMARKS BUILD_EXAMPLES BUILD_FUZZERS BUILD_PLUGINS BUILD_SHARED BUILD_STATIC BUILD_TESTS DEACTIVATE_IPP PREFER_EXTERNAL_LZ4 PREFER_EXTERNAL_ZLIB PREFER_EXTERNAL_ZSTD TEST_INCLUDE_COMPAT TEST_INCLUDE_EXAMPLES
USE_LDCONFIG=	yes

PLIST_SUB=	PORTVERSION=${PORTVERSION}

GH_ACCOUNT=	Blosc
USE_GITHUB=	yes

.include <bsd.port.options.mk>

.if ${ARCH} == powerpc64le
USES+=		compiler:gcc-c++11-lib
USE_CSTD=	c11
.endif

do-test:
	cd ${TEST_WRKSRC} && ctest

.include <bsd.port.mk>
