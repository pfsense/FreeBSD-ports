PORTNAME=	spfft
DISTVERSIONPREFIX=	v
DISTVERSION=	1.0.6
PORTREVISION=	1
CATEGORIES=	math

MAINTAINER=	yuri@FreeBSD.org
COMMENT=	Sparse 3D FFT library
WWW=		https://github.com/eth-cscs/SpFFT

LICENSE=	BSD3CLAUSE
LICENSE_FILE=	${WRKSRC}/LICENSE

LIB_DEPENDS=	libfftw3.so:math/fftw3

USES=		cmake:testing compiler:c++11-lang
USE_LDCONFIG=	yes

USE_GITHUB=	yes
GH_ACCOUNT=	eth-cscs
GH_PROJECT=	SpFFT

CMAKE_TESTING_ON=	SPFFT_BUILD_TESTS
CMAKE_TESTING_TARGET=	${ALL_TARGET}

OPTIONS_DEFINE=		FORTRAN OPENMP
OPTIONS_SINGLE=		MPI
OPTIONS_SINGLE_MPI=	NOMPI MPICH OPENMPI
OPTIONS_DEFAULT=	FORTRAN MPICH OPENMP
OPTIONS_SUB=		yes

FORTRAN_USES=		fortran
FORTRAN_CMAKE_BOOL=	SPFFT_FORTRAN

NOMPI_DESC=		Build without parallel processing support
NOMPI_CMAKE_ON=		-DSPFFT_MPI=OFF

MPICH_USES=		mpi:mpich
MPICH_CMAKE_ON=		-DSPFFT_MPI=ON

OPENMPI_USES=		mpi:openmpi
OPENMPI_CMAKE_ON=	-DSPFFT_MPI=ON

OPENMP_CMAKE_BOOL=	SPFFT_OMP

post-test:
	@cd ${BUILD_WRKSRC}/tests && \
		./run_local_tests && \
		./run_mpi_tests

.include <bsd.port.mk>
