PORTNAME=	uriparser
DISTVERSION=	0.9.9
CATEGORIES=	net
MASTER_SITES=	https://github.com/uriparser/uriparser/releases/download/uriparser-${DISTVERSION}/
DISTFILES=	${DISTNAME}${EXTRACT_SUFX}
EXTRACT_ONLY=	${DISTNAME}${EXTRACT_SUFX}

MAINTAINER=	svysh.fbsd@gmail.com
COMMENT=	URI parsing library
WWW=		https://github.com/uriparser/uriparser

LICENSE=			APACHE20 BSD3CLAUSE LGPL21+
LICENSE_COMB=			multi
LICENSE_FILE_APACHE20=		${WRKSRC}/COPYING.Apache-2.0
LICENSE_FILE_BSD3CLAUSE=	${WRKSRC}/COPYING.BSD-3-Clause
LICENSE_FILE_LGPL21+ =		${WRKSRC}/COPYING.LGPL-2.1
LICENSE_FILE=			${WRKSRC}/README.md

BUILD_DEPENDS=	bash:shells/bash
TEST_DEPENDS=	googletest>=1.10.0:devel/googletest

USES=		cmake:noninja,testing cpe pathfix tar:xz
CPE_VENDOR=	uriparser_project

USE_LDCONFIG=	yes

CMAKE_OFF=	URIPARSER_BUILD_TESTS \
		URIPARSER_BUILD_DOCS # will fetch prebuilds from the upstream, if DOCS is selected
CMAKE_TESTING_ON=	URIPARSER_BUILD_TESTS

PLIST_SUB=	DISTVERSION=${DISTVERSION}
PORTDOCS=	*

OPTIONS_DEFINE=		DOCS
DOCS_DISTFILES=		${_DISTDOCSFILE} \
			${_DISTDOCSNAME}.qch
DOCS_EXTRACT_ONLY=	${_DISTDOCSFILE}

_DISTDOCSFILE=	${_DISTDOCSNAME}.zip
_DISTDOCSNAME=	${DISTNAME}-doc

post-install-DOCS-on:
	${MKDIR} ${STAGEDIR}${DOCSDIR}/qch
	cd ${WRKSRC}/doc && ${COPYTREE_SHARE} . ${STAGEDIR}${DOCSDIR}
	cd ${WRKSRC}/../${_DISTDOCSNAME} && ${COPYTREE_SHARE} . ${STAGEDIR}${DOCSDIR}
	${INSTALL_MAN} ${DISTDIR}/${_DISTDOCSNAME}.qch ${STAGEDIR}${DOCSDIR}/qch
	( ${ECHO} "QCH file is a QT Compressed Help file, generated by doxygen, cf:"; \
	${ECHO} "https://doc.qt.io/qt-5/assistant-details.html"; ) > ${STAGEDIR}${DOCSDIR}/qch/readme-qch

.include <bsd.port.mk>
