<?xml version="1.0"?>
<pfsensewizard>
        <copyright><![CDATA[
/*
 * vpc_vpn_wizard.xml
 *
 * part of pfSense (https://www.pfsense.org)
 * Copyright (c) 2014-2020 Rubicon Communications, LLC (Netgate)
 * All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
	]]>
	</copyright>

	<totalsteps>6</totalsteps>
	<step>
		<id>1</id>
		<title>pfSense VPC VPN Configuration Wizard</title>
		<disableheader>on</disableheader>
		<description>This wizard will guide you through setting up a VPN connection to Amazon's Virtual Private Cloud</description>
		<fields>
			<field>
				<type>listtopic</type>
				<name>AWS API Credentials</name>
			</field>
			<field>
				<displayname>Access Key ID</displayname>
				<name>awskey</name>
				<type>input</type>
				<description>Your AWS Access Key ID</description>
				<bindstofield>vpc->step1->awskey</bindstofield>
			</field>
			<field>
				<displayname>Secret Access Key</displayname>
				<name>secret</name>
				<type>input</type>
				<description>Your AWS Secret Key</description>
			</field>
			<field>
				<displayname>Assume Role ARN</displayname>
				<name>awsrole</name>
				<type>input</type>
				<description>Use EC2 instance profile to assume role instead of keys</description>
				<bindstofield>vpc->step1->awsrole</bindstofield>
			</field>
			<field>
				<displayname>Partition</displayname>
				<name>partition</name>
				<type>select</type>
				<description>The AWS Partition your VPC resides in</description>
				<bindstofield>vpc->step1->partition</bindstofield>
				<options>
					<option>
						<name>AWS Public Cloud</name>
						<value>aws</value>
					</option>
					<option>
						<name>AWS US Government</name>
						<value>aws-us-gov</value>
					</option>
				</options>
			</field>
			<field>
				<name>Next</name>
				<type>submit</type>
			</field>
		</fields>
		<stepsubmitphpaction>submit_creds_partition();</stepsubmitphpaction>
		<includefile>/usr/local/www/wizards/vpc_vpn_wizard.inc</includefile>
	</step>
	<step>
		<id>2</id>
		<title>pfSense VPC VPN Configuration Wizard</title>
		<description>Region Selection</description>
		<fields>
			<field>
				<name>Next</name>
				<type>submit</type>
			</field>
		</fields>
		<stepbeforeformdisplay>pre_region_select();</stepbeforeformdisplay>
		<stepsubmitphpaction>submit_region_select();</stepsubmitphpaction>
		<includefile>/usr/local/www/wizards/vpc_vpn_wizard.inc</includefile>
	</step>
	<step>
		<id>3</id>
		<title>pfSense VPC VPN Configuration Wizard</title>
		<description>VPC Selection</description>
		<fields>
			<field>
				<name>Next</name>
				<type>submit</type>
			</field>
		</fields>
		<stepbeforeformdisplay>before_vpc_select();</stepbeforeformdisplay>
		<stepsubmitphpaction>submit_vpc_select();</stepsubmitphpaction>
		<includefile>/usr/local/www/wizards/vpc_vpn_wizard.inc</includefile>
	</step>
	<step>
		<id>4</id>
		<title>pfSense VPC VPN Configuration Wizard</title>
		<description>Create and Configure VPN Connection on AWS</description>
		<fields>
			<field>
				<name>routing</name>
				<type>select</type>
				<description>Use static or dynamic (BGP) routing. Static is likely the best option for simple topologies.</description>
				<displayname>Routing Type</displayname>
				<bindstofield>vpc->step4->routing</bindstofield>
				<options>
					<option>
						<name>Static</name>
						<value>static</value>
					</option>
					<option>
						<name>BGP</name>
						<value>BGP</value>
					</option>
				</options>
			</field>
			<field>
				<name>bgpasn</name>
				<type>input</type>
				<description>If you selected BGP routing, enter the local BGP AS number to use. This could be an AS number assigned to you by a numbering authority (E.g. ARIN, RIPE) or it could be a private AS number in the range 64512-65534. Defaults to 65000.</description>
				<displayname>BGP AS number</displayname>
				<bindstofield>vpc->step4->bgpasn</bindstofield>
			</field>
			<field>
				<name>locpubip</name>
				<type>input</type>
				<description>Either a public IP address assigned to the interface your tunnels will terminate on, or a public IP address that is port forwarded or NATed by an upstream device to a private IP address on the interface your tunnels will terminate on.</description>
				<displayname>Local Public IP Address</displayname>
				<bindstofield>vpc->step4->locpubip</bindstofield>
			</field>
			<field>
				<name>loccidrs</name>
				<type>input</type>
				<description>Enter a list of local subnets (ones that are directly connected to the firewall) that hosts in your VPC should be able to reach over the VPN tunnel. Expressed as a comma-separated list of one or more CIDR ranges.</description>
				<displayname>Local subnets</displayname>
				<bindstofield>vpc->step4->loccidrs</bindstofield>
			</field>
			<field>
				<name>updatesecgroups</name>
				<type>checkbox</type>
				<description>Select to allow local subnets access in all security groups.  Alternatively you will need to add appriopriate rules yourself.</description>
				<displayname>Update Security Groups</displayname>
				<bindstofield>vpc->step4->updatesecgroups</bindstofield>
			</field>
			<field>
				<name>Next</name>
				<type>submit</type>
				<description>The VPN Connection will be created (resulting in Amazon initiating hourly charges for the connection) and Security Groups and Routing Tables will be modified appropriately on the AWS side. Note that this step may take a few minutes if you are using static routing because static routes cannot be added until the VPN Connection is fully available according to Amazon's EC2 API.</description>
			</field>
		</fields>
		<stepsubmitphpaction>submit_configure_create_vpn();</stepsubmitphpaction>
		<includefile>/usr/local/www/wizards/vpc_vpn_wizard.inc</includefile>
	</step>
	<step>
		<id>5</id>
		<title>pfSense VPC VPN Configuration Wizard</title>
		<description>Create IPsec Tunnels and Configure Related Elements on pfSense</description>
		<fields>
			<field>
				<name>interface</name>
				<type>interfaces_selection</type>
				<description>The interface for the local endpoint of the tunnels.</description>
				<displayname>Interface</displayname>
				<bindstofield>vpc->step5->interface</bindstofield>
			</field>
			<field>
				<name>Next</name>
				<type>submit</type>
				<description>This will create the IPsec VPN configurations, firewall rules, aliases, routing configurations and virtual IPs required for pfSense to communicate with the AWS VPC VPN Connection.</description>
			</field>
		</fields>
		<stepsubmitphpaction>submit_create_tunnels_config_pfsense();</stepsubmitphpaction>
		<includefile>/usr/local/www/wizards/vpc_vpn_wizard.inc</includefile>
	</step>
	<step>
		<id>6</id>
		<title>pfSense VPC VPN Configuration Wizard</title>
		<description>Apply configuration changes and bring up VPN</description>
		<fields>
			<field>
				<name>Next</name>
				<type>submit</type>
				<description>Click next to apply configuration changes and connect this pfSense instance to the AWS VPC VPN Connection that has been created.</description>
			</field>
		</fields>
		<stepsubmitphpaction>submit_apply_config_changes();</stepsubmitphpaction>
		<includefile>/usr/local/www/wizards/vpc_vpn_wizard.inc</includefile>
	</step>
</pfsensewizard>
