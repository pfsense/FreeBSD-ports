--- Makefile.orig	2022-10-05 23:40:03 UTC
+++ Makefile
@@ -239,19 +239,19 @@ AM_SHARE = $(AM_V_CCLD) $(CXX) $(PLATFORM_SHARED_LDFLA
 # Detect what platform we're building on.
 # Export some common variables that might have been passed as Make variables
 # instead of environment variables.
-dummy := $(shell (export ROCKSDB_ROOT="$(CURDIR)"; \
-                  export CXXFLAGS="$(EXTRA_CXXFLAGS)"; \
-                  export LDFLAGS="$(EXTRA_LDFLAGS)"; \
-                  export COMPILE_WITH_ASAN="$(COMPILE_WITH_ASAN)"; \
-                  export COMPILE_WITH_TSAN="$(COMPILE_WITH_TSAN)"; \
-                  export COMPILE_WITH_UBSAN="$(COMPILE_WITH_UBSAN)"; \
-                  export PORTABLE="$(PORTABLE)"; \
-                  export ROCKSDB_NO_FBCODE="$(ROCKSDB_NO_FBCODE)"; \
-                  export USE_CLANG="$(USE_CLANG)"; \
-                  export LIB_MODE="$(LIB_MODE)"; \
-		  export ROCKSDB_CXX_STANDARD="$(ROCKSDB_CXX_STANDARD)"; \
-		  export USE_FOLLY="$(USE_FOLLY)"; \
-                  "$(CURDIR)/build_tools/build_detect_platform" "$(CURDIR)/make_config.mk"))
+#dummy := $(shell (export ROCKSDB_ROOT="$(CURDIR)"; \
+#                  export CXXFLAGS="$(EXTRA_CXXFLAGS)"; \
+#                  export LDFLAGS="$(EXTRA_LDFLAGS)"; \
+#                  export COMPILE_WITH_ASAN="$(COMPILE_WITH_ASAN)"; \
+#                  export COMPILE_WITH_TSAN="$(COMPILE_WITH_TSAN)"; \
+#                  export COMPILE_WITH_UBSAN="$(COMPILE_WITH_UBSAN)"; \
+#                  export PORTABLE="$(PORTABLE)"; \
+#                  export ROCKSDB_NO_FBCODE="$(ROCKSDB_NO_FBCODE)"; \
+#                  export USE_CLANG="$(USE_CLANG)"; \
+#                  export LIB_MODE="$(LIB_MODE)"; \
+#		  export ROCKSDB_CXX_STANDARD="$(ROCKSDB_CXX_STANDARD)"; \
+#		  export USE_FOLLY="$(USE_FOLLY)"; \
+#                  "$(CURDIR)/build_tools/build_detect_platform" "$(CURDIR)/make_config.mk"))
 # this file is generated by the previous line to set build flags and sources
 include make_config.mk
 
@@ -876,7 +876,7 @@ endif  # PLATFORM_SHARED_EXT
 	rocksdbjavastatic rocksdbjava install install-static install-shared \
 	uninstall analyze tools tools_lib check-headers checkout_folly
 
-all: $(LIBRARY) $(BENCHMARKS) tools tools_lib test_libs $(TESTS)
+all: $(LIBRARY) $(BENCHMARKS) tools tools_lib test_libs # $(TESTS)
 
 all_but_some_tests: $(LIBRARY) $(BENCHMARKS) tools tools_lib test_libs $(ROCKSDBTESTS_SUBSET)
 
@@ -1273,7 +1273,7 @@ package:
 # 	Unit tests and tools
 # ---------------------------------------------------------------------------
 $(STATIC_LIBRARY): $(LIB_OBJECTS)
-	$(AM_V_AR)rm -f $@ $(SHARED1) $(SHARED2) $(SHARED3) $(SHARED4)
+	$(AM_V_AR)rm -f $@
 	$(AM_V_at)$(AR) $(ARFLAGS) $@ $(LIB_OBJECTS)
 
 $(STATIC_TEST_LIBRARY): $(TEST_OBJECTS)
